```
                    ARCHY HYBRID ARCHITECTURE
                    =========================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚                    USER INTERACTION                        â”‚
â”‚                  (Terminal / Commands)                     â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ENTRY POINT (Bash)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  scripts/archy                                       â”‚   â”‚
â”‚  â”‚  â€¢ Parse CLI arguments                               â”‚   â”‚
â”‚  â”‚  â€¢ Check daemon status                               â”‚   â”‚
â”‚  â”‚  â€¢ Auto-start executor if needed                     â”‚   â”‚
â”‚  â”‚  â€¢ Launch Python brain                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PYTHON BRAIN (AI Logic Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  scripts/archy_chat.py                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Gemini API Integration                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Conversation History Management              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Natural Language Understanding               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Intent Detection & Decision Making           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Response Generation                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Context Management                           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ IPC Bridge
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     IPC COMMUNICATION (Unix Domain Socket)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  scripts/rust_executor.py                             â”‚   â”‚
â”‚  â”‚  â€¢ Socket: /tmp/archy.sock                            â”‚   â”‚
â”‚  â”‚  â€¢ Protocol: JSON messages                            â”‚   â”‚
â”‚  â”‚  â€¢ Methods:                                           â”‚   â”‚
â”‚  â”‚    - execute_in_tmux(command)                         â”‚   â”‚
â”‚  â”‚    - capture_output(lines)                            â”‚   â”‚
â”‚  â”‚    - check_session()                                  â”‚   â”‚
â”‚  â”‚    - open_terminal()                                  â”‚   â”‚
â”‚  â”‚    - close_terminal()                                 â”‚   â”‚
â”‚  â”‚    - close_session()                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ JSON over Unix Socket
                             â”‚ {"action": "...", "data": {...}}
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RUST HANDS (System Operations Layer)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  src/main.rs (archy-executor daemon)                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ UnixListener on /tmp/archy.sock                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Action Handlers:                         â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ execute_command()                      â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> tmux send-keys                     â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ capture_tmux_output()                  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> tmux capture-pane                  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ check_tmux_session()                   â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> tmux has-session                   â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ open_terminal()                        â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> tmux new-session + foot            â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ close_terminal()                       â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> pgrep + kill foot                  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ close_session()                        â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€> pkill + tmux kill-session          â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SYSTEM INTEGRATION LAYER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    tmux     â”‚  â”‚    foot     â”‚  â”‚    bash      â”‚         â”‚
â”‚  â”‚  (session)  â”‚  â”‚ (terminal)  â”‚  â”‚   (shell)    â”‚         â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚              â”‚         â”‚
â”‚  â”‚ â€¢ Persistentâ”‚  â”‚ â€¢ GUI       â”‚  â”‚ â€¢ Executes   â”‚         â”‚
â”‚  â”‚   session   â”‚â—„â”€â”¤   window    â”‚  â”‚   commands   â”‚         â”‚
â”‚  â”‚ â€¢ Command   â”‚  â”‚ â€¢ User      â”‚  â”‚ â€¢ Provides   â”‚         â”‚
â”‚  â”‚   buffer    â”‚  â”‚   visible   â”‚  â”‚   output     â”‚         â”‚
â”‚  â”‚ â€¢ History   â”‚  â”‚ â€¢ Resizable â”‚  â”‚ â€¢ Working    â”‚         â”‚
â”‚  â”‚ â€¢ Capture   â”‚  â”‚ â€¢ Closable  â”‚  â”‚   directory  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA FLOW EXAMPLE: "list my files"
===================================

1. User types: archy "list my files"

2. Bash script (scripts/archy):
   â”œâ”€ Checks if /tmp/archy.sock exists
   â”œâ”€ Starts daemon if needed
   â””â”€ Launches Python: python3 archy_chat.py "list my files"

3. Python Brain (archy_chat.py):
   â”œâ”€ Sends to Gemini API: "User wants to list files"
   â”œâ”€ Gemini responds: "Run 'ls -la' command"
   â”œâ”€ Python decides: Execute in terminal
   â””â”€ Calls: rust_executor.execute_in_tmux("ls -la")

4. IPC Bridge (rust_executor.py):
   â”œâ”€ Connects to /tmp/archy.sock
   â”œâ”€ Sends JSON: {"action": "execute", "data": {"command": "ls -la"}}
   â””â”€ Waits for response

5. Rust Hands (archy-executor):
   â”œâ”€ Receives JSON message
   â”œâ”€ Parses action: "execute"
   â”œâ”€ Runs: Command::new("tmux").args(&["send-keys", "-t", "archy_session", "ls -la", "C-m"])
   â”œâ”€ Returns: {"success": true, "output": "âœ“ Executed: ls -la"}
   â””â”€ Sends JSON back over socket

6. IPC Bridge returns to Python

7. Python Brain:
   â”œâ”€ Waits briefly (command execution time)
   â”œâ”€ Calls: rust_executor.capture_output(100)
   â””â”€ Gets terminal output

8. IPC Bridge (rust_executor.py):
   â”œâ”€ Sends: {"action": "capture", "data": {"lines": 100}}
   â””â”€ Receives terminal text

9. Rust Hands:
   â”œâ”€ Runs: Command::new("tmux").args(&["capture-pane", "-pt", "archy_session", "-S", "-100"])
   â””â”€ Returns: {"success": true, "output": "total 48\ndrwxr-xr-x..."}

10. Python Brain:
    â”œâ”€ Sends output to Gemini: "Analyze this: total 48..."
    â”œâ”€ Gemini responds with summary
    â””â”€ Displays to user: "Here are your files: [list]"

11. User sees response


KEY ADVANTAGES
==============

ğŸš€ PERFORMANCE
  â€¢ Rust executor is compiled â†’ ~50x faster than Python subprocess
  â€¢ Unix socket IPC â†’ ~10Î¼s latency (vs ~1ms for subprocess)
  â€¢ Daemon stays resident â†’ no startup cost per operation
  â€¢ Efficient process monitoring with Rust

ğŸ›¡ï¸ RELIABILITY
  â€¢ Rust's type system catches errors at compile time
  â€¢ Better error handling with Result<T, E>
  â€¢ Memory safety guarantees (no segfaults)
  â€¢ Process tracking more robust than Python

ğŸ§¹ MAINTAINABILITY
  â€¢ Clear separation: AI logic vs system operations
  â€¢ Python code stays focused on Gemini API & conversation
  â€¢ Rust code isolated to system calls
  â€¢ Well-defined JSON protocol between layers
  â€¢ Easy to test components independently

ğŸ”§ EXTENSIBILITY
  â€¢ Add new actions by updating Rust match statement
  â€¢ Python doesn't need to know about system details
  â€¢ Could support multiple frontends (CLI, GUI, Web)
  â€¢ Easy to add logging, metrics, authentication layer


FILES OVERVIEW
==============

Core Components:
  src/main.rs              - Rust executor daemon (system operations)
  scripts/archy_chat.py    - Python brain (AI logic)
  scripts/rust_executor.py - IPC bridge (socket communication)
  scripts/archy            - Entry point (bash launcher)

Build & Deploy:
  Cargo.toml               - Rust dependencies (serde, serde_json)
  install.sh               - Build & install script
  start_daemon.sh          - Start executor daemon
  stop_daemon.sh           - Stop executor daemon

Testing:
  test_executor.py         - Test suite for executor

Documentation:
  README.md                - User guide & quick start
  ARCHITECTURE.md          - Detailed design documentation
  MIGRATION.md             - Migration summary & changes

Generated:
  target/release/archy-executor  - Compiled Rust binary (~5MB)
  /tmp/archy.sock                - Unix socket for IPC


INSTALLATION & USAGE
====================

Install:
  sudo pacman -S rust tmux foot python
  ./install.sh

Run:
  archy "what is my IP?"         # Single query
  archy                          # Interactive mode

Daemon Control:
  ./start_daemon.sh              # Manual start
  ./stop_daemon.sh               # Manual stop
  # (Auto-starts when using 'archy' command)

Test:
  python3 test_executor.py       # Run test suite
```

